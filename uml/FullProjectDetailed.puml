@startuml

' === RELATIONSHIP LEGEND ===
' <|--  : Herencia (Inheritance)
' --    : Asociación (Association)
' *--   : Composición (Composition)
' ..>   : Asociación débil (Weak association / usage)
' "1"   : Uno
' "0..*" o "*" : Muchos
' "1..3": Entre uno y tres

' ENUMS
package "Enums" {
    enum ManaCondition {
        None
        ByTime
        Instant
    }
}

' BASE COMPONENTS
package "Base" {
    abstract class StatComponent {
        -maxValue : int
        -currentValue : int
        +MaxValue : int
        +CurrentValue : int
        +SetValue(value : int) : void
        +AffectValue(value : int) : void
    }

    abstract class BaseStatHolder {
        [protected] health : HealthComponent
        +Health : HealthComponent
        +TakeDamage(amount : int) : void
    }
}

package "Components" {
    class HealthComponent {
        +CurrentHealth : int
        +MaxHealth : int
        +Heal(amount : int) : void
        +TakeDamage(amount : int) : void
        +SetHealth(value : int) : void
        +CurrentValue : int
        +MaxValue : int
    }

    class ManaComponent {
        +CurrentMana : int
        +MaxMana : int
        +Condition : ManaCondition
        +UseResource(amount : int) : void
        +RecoverResource(amount : int) : void
        +SetMana(value : int) : void
        +AffectValue(value : int) : void
        +CurrentValue : int
        +MaxValue : int
    }
}

package "Player.Holders" {
    class PlayableStatHolder {
        -mana : ManaComponent
        +Mana : ManaComponent
        +AbilitySystem : SystemAbility
        +AddAbility(ability : AbilityBase) : void
        +RemoveAbility(ability : AbilityBase) : void
        +UseAbility(index : int) : void
        +InitializeAbilities(healIcon, areaIcon, projectileIcon, projectilePrefab) : void
        +Initialize(health : HealthComponent, mana : ManaComponent) : void
        +TakeDamage(amount : int) : void
    }
}

package "Agentes.NPC" {
    class NonPlayableStatHolder {
        +OnDeath : Action
        +CheckDeath() : void
    }
}

package "Agentes" {
    class SoulMage {
        +UseHealth(amount : int) : void
        +RecoverHealth(amount : int) : void
        +GetCurrentHealth() : int
        +GetMaxHealth() : int
    }

    class ManaKnight {
        +ManaComponent : ManaComponent
        +UseMana(amount : int) : void
        +GetCurrentMana() : int
        +GetMaxMana() : int
    }
}

package "Abilities.Base" {
    abstract class AbilityBase {
        +Name : string
        +Icon : Sprite
        +Cooldown : float
        +ResourceCost : int
        +CanUse(user : PlayableStatHolder) : bool
        +Use(user : PlayableStatHolder) : void
        +OnAbilityEffect(user : PlayableStatHolder) : void
    }
}

package "Abilities.Habilities" {
    class HealAbility {
        +HealAbility(name : string, icon : Sprite, resourceCost : int = 0)
        +CanUse(user : PlayableStatHolder) : bool
        +OnAbilityEffect(user : PlayableStatHolder) : void
    }

    class AreaDamageAbility {
        +AreaDamageAbility(name : string, icon : Sprite, radius : float = 5f, damage : int = 30, resourceCost : int = 0)
        +CanUse(user : PlayableStatHolder) : bool
        +OnAbilityEffect(user : PlayableStatHolder) : void
    }

    class ProjectileAbility {
        +ProjectileAbility(name : string, icon : Sprite, projectilePrefab : GameObject = null, projectileSpeed : float = 20f, resourceCost : int = 0)
        +CanUse(user : PlayableStatHolder) : bool
        +OnAbilityEffect(user : PlayableStatHolder) : void
    }
}

package "Abilities.System" {
    class SystemAbility {
        +AllAbilities : List<AbilityBase>
        +SelectedAbilityIndex : int
        +GetAbilityByName(name : string) : AbilityBase
        +AddAbility(ability : AbilityBase) : void
        +RemoveAbility(ability : AbilityBase) : void
        +GetSelectedAbility() : AbilityBase
        +UseSelectedAbility(user : PlayableStatHolder) : void
    }
}

package "Areas.Recovery" {
    class HealthArea {
        +healthAmount : int
        +interval : float
        +OnTriggerEnter(other : Collider) : void
        +OnTriggerExit(other : Collider) : void
        +Update() : void
    }
    class ManaArea {
        +manaAmount : int
        +interval : float
        +OnTriggerEnter(other : Collider) : void
        +OnTriggerExit(other : Collider) : void
        +Update() : void
    }
}

package "Areas.Damage" {
    class ProjectileDamage {
        -damage : int
        +SetDamage(dmg : int) : void
        +OnTriggerEnter(other : Collider) : void
    }

    class AreaDamage {
        +damage : int
        +damageInterval : float
        +SetDamage(dmg : int) : void
        +OnTriggerEnter(other : Collider) : void
        +OnTriggerExit(other : Collider) : void
        +Update() : void
    }
}

' === RELATIONS WITH EXPLANATION ===

' Herencia
Base.StatComponent <|-- Components.HealthComponent : "Herencia"
Base.StatComponent <|-- Components.ManaComponent : "Herencia"
Base.BaseStatHolder <|-- Player.Holders.PlayableStatHolder : "Herencia"
Base.BaseStatHolder <|-- Agentes.NPC.NonPlayableStatHolder : "Herencia"
Player.Holders.PlayableStatHolder <|-- Agentes.SoulMage : "Herencia"
Player.Holders.PlayableStatHolder <|-- Agentes.ManaKnight : "Herencia"
Abilities.Base.AbilityBase <|-- Abilities.Habilities.HealAbility : "Herencia"
Abilities.Base.AbilityBase <|-- Abilities.Habilities.AreaDamageAbility : "Herencia"
Abilities.Base.AbilityBase <|-- Abilities.Habilities.ProjectileAbility : "Herencia"

' Asociación
Base.BaseStatHolder -- Components.HealthComponent : "Asociación health"
Player.Holders.PlayableStatHolder -- Components.ManaComponent : "Asociación mana"
Player.Holders.PlayableStatHolder -- Abilities.System.SystemAbility : "Asociación AbilitySystem"
Components.ManaComponent -- Enums.ManaCondition : "Asociación Condition"

' Composición: SystemAbility contiene de 1 a n habilidades
Abilities.System.SystemAbility "1" *-- "*" Abilities.Base.AbilityBase : "AllAbilities"

' Asociación débil / uso
Areas.Recovery.HealthArea ..> Components.HealthComponent : "uso OnTriggerEnter/Exit/Update"
Areas.Recovery.ManaArea ..> Components.ManaComponent : "uso OnTriggerEnter/Exit/Update"
Areas.Damage.ProjectileDamage ..> Components.HealthComponent : "uso OnTriggerEnter"
Areas.Damage.AreaDamage ..> Components.HealthComponent : "uso OnTriggerEnter/Exit/Update"

@enduml